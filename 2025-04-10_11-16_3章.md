# AWSのコンピューティング環境
仮想マシンとは、クラウド上に置かれるサーバーコンピュータ
コンテナとは、複数の疑似的な環境を構築する方法の一つ。
アプリとその実行に必要なライブラリを1つの仮想環境に閉じ込めたもの。
仮想マシンとの違いは、高速に起動や収量ができる点。（ポータビリティの高さ）
Amazon ECSやAmazon EKSなど

サーバーレスコンピューティングとは、サーバーの管理や運用、構築をすることなく利用できるコンピューティング環境。
AWS Lambda

# EC2
仮想マシン提供サービス
作成された仮想マシンはEC2インスタンスと呼ぶ。
作成の流れ
Amazon Machine Imageの選択
|
ストレージの選択
|
ネットワークの選択
|
その他の選択

Amazon Machine Image(AMI)とは、OSやアプリがインストールされたEC2インスタンスのひな型
ユーザーはAMIを選択しただけで整った環境をすぐ利用できる。
Amazonが用意したAMIやユーザーやサードパーティベンダーが用意したAMIがある
EC2インスタンスの性能に関する情報は含まれていない。

# インスタンスタイプ
5つのカテゴリ
汎用　webサーバー、アプリケーションサーバー、開発サーバーなどの用途
コンピューティング最適化　計算負荷の高いアプリケーションサーバー、バッチ処理システムなど
メモリ最適化　データベースサーバー、キャッシュサーバーなど、大量な非構造化データのリアルタイム処理
高速コンピューティング　浮動小数点演算、グラフィックス処理、機械学習など
ストレージ最適化　分散ファイルシステム、データウェアハウスなど

インスタンスタイプの命名規則
t4g.small
左から、インスタンスファミリー、世代、オプション、インスタンスサイズ
インスタンスファミリーとは、インスタンスタイプをアルファベットに分類、一つのインスタンスタイプに複数のインスタンスファミリーがある場合もある
世代は、数字が大きいほど新しい、性能やコスト面で優れたものを表す
オプションは、利用可能なCPUの種類やネットワークに特化した機能などの特徴を表す。
インスタンスサイズは、PUやメモリ、ストレージやネットワーク性能を表す。smallやlargeなど。

EC2の料金は、起動した時間に対する従量課金。
複数の料金プランが存在する。

オンデマンドインスタンス
EC2が起動している時間に対して課金される。
動き始めたら中断できない作業や、終了時間が予測できない作業に向いてる
インスタンスを起動するホストを選ぶことはできない

スポットインスタンス
AWS上で余っているEC2キャパシティを、オンデマンドインスタンスと比べて最大9割安く利用できる。
余っている量に応じて価格が変動する
AWS側でキャパシティが不足してきた場合は、利用中であっても中断される。
途中で中断されても影響のない作業や、短時間の利用に向いている
インスタンスを起動するホストを選ぶことはできない

リザーブドインスタンス
1年または3年の利用を確約し、最大72％の割引を受ける。
OSやインスタンスタイプを変えることなく、安定して長期間利用が見込まれる作業に向く

Saving Plan
1年または3年の利用を確約し、最大72％の割引を受ける。
1時間当たりどれくらいの利用料金を予定しているのかを条件として購入
長期的利用に向く、かつ、柔軟な攻勢が利用できる

ハードウェア専有インスタンス
EC2インスタンスが起動するほすとを、自分たちのAWSアカウントのインスタンスだけで独占する。
オンデマンドインスタンスより割高。

Dedicated Hosts
ハードウェア専有インスタンス同様にホストを専有するプランだが、インスタンスを起動できるホストを指定できる
もっとも料金が高い

# Amazon EC2 Auto Scaling
スケールアップとスケールダウン
サーバー単体の性能を向上させること/下げること
実行中のサーバーには行えず、サーバーの停止が必要

スケールアウトとスケールイン
スケールアウトは、サーバーの台数を増やすことで全体のパフォーマンスを向上させるという考え方
スケールインは、台数を減らしていくという考え方。

Auto Scalingは、ec2インスタンスのスケールアウト/インを自動で行う仕組み
cloudwatchで収集された情報を基に増減する
auto scalingで起動するインスタンスを、起動テンプレートを利用してあらかじめ定義できる
auto scalingグループは、auto scalingによって起動するec2インスタンスの台数を調整する

スケーリングポリシーを設定することで、需要に対する供給のコントロールが実施できる
auto scalingが実行されるタイミングや条件を設定できる
3つのタイプがある
動的スケーリングポリシー
予定されたアクション
予測スケーリングポリシー

# elastic load balancing
AWSクラウド上で利用できるロードバランサーサービス(負荷分散装置)
複数のアベイラビリティゾーンにまたがった負荷分散を実現できる
マネージドサービスであり、管理運用が不要かつ、単一障害点にならず
elbには4種のロードバランサーがある

Application Load Balancer
http/httpsのリクエストを対象とした負荷分散を行う
webサーバーやwebアプリケーションでの利用に特化した機能が提供される

network load balancer
http/https以外のプロトコルを利用する場合や、静的なグローバルIPアドレスを必要とする場合に利用される

gateway load balancer
ネットワーク同士の接続に対する負荷分散を行う

ヘルスチェック機能は、ターゲットに登録されているec2インスタンスなどが正常に応答を返すかをチェックする仕組み

auto scalingと組み合わせて、自動で起動したインスタンスをelastic load balancingの対象に含めることができる

# amazon elastic container service ecs
dockerコンテナを管理するためのオーケストレーションサービスであり、マネージドサービス

# amazon elastic kuberneets service
kubernetesのオーケストレーションサービス

# aws fargate
コンテナの実行環境をサーバーレス化し、awsに管理をすべて任せてしまうサービス
amazon ecsとeksで構築されるコンテナ実行環境をサーバーレス化する

# amazon elastic container registry ecr
フルマネージドサービスなコンテナレジストリサービス
コンテナイメージの保管やバージョン管理、イメージの配布が行える

# aws lambda
サーバーを意識せずにプログラムコードを実行することができるサービス
実行したいプログラムをlambda関数として登録しておき、トリガーを設定する
lambda関数の実行にかかった時間に対してミリ秒単位で料金か算出される
最大実行時間は15分

# amazon lightsail
awsが提供するvirtual private serverサービス
os、ストレージ、ファイアウォールなどの機能をパッケージとして仮想マシンに詰め込んで提供する

# amazon workspaces
virtual desktop infrastructureサービス、仮想デスクトップサービス
ネットワーク上に、どこからでもアクセスできるデスクトップ環境w構築できる

# aws batch
数巡万件のバッチジョブの実行に適したサービス

amazon machine imageは、osやアプリケーションをインストール済みのec2インスタンスのひな型
5つのインスタンスタイプ
webサーバー、アプリサーバー、開発サーバーなどの用途の、汎用インスタンス
計算負荷の高いアプリケーションサーバー、バッチ処理システムなどの、コンピューティング最適化
dbサーバー、キャッシュサーバーなど、メモリ最適化
浮動小数点演算、グラフィックス処理、機械学習など、高速コンピューティング
分散ファイルシステム、データウェアハウスなど、ストレージ最適化

# ユーザー認証の基本
aws認証の中で、主にプログラムや外部サービスが利用するアクセスキーとシークレットキーは、awsが自動生成する
シークレットアクセスキーは、アクセスキー生成時しか確認できない

# パスワードポリシー
ユーザーのパスワードの検証ルールを設定する

# MFA multi factor authentication
id/pwに加えて、mfaデバイスと呼ばれる装置で、本人だけが知りえる情報で認証を行う方法。多要素認証ともいう。
mfaデバイスとは、
・仮想mfaデバイス　スマホアプリのあれ
・セキュリティキー　usbにさして利用するなどの物理的デバイス
・ハードウェアトークンデバイス　物理的デバイスの、仮想mfaデバイス　つまりスマホではない？たぶん

# iam
個別のiamユーザー
開発チーム・運用チームなどのiamグループ
操作可能なリソースやアクションはiamポリシーによってグループごとに設定

# ユーザは2種類
ルートユーザーとiamユーザの2種類
ルートユーザー
アカウント作成と同時に利用できるユーザー、アカウント内すべての操作を実行できる管理者アカウント
なるべく利用は避けるべき　最小権限の法則

iamユーザー
認証情報を持つリソース
作成直後は権限を一切持っていない
iamポリシーを利用して適切な権限を付与する必要がある

iamロール
iamユーザーやawsサービスが一時的に別のアクセス権限を利用できるようにする仕組み

# aws iam identity center
複数のawsアカウントやawsリソースを利用する外部サービスに対して、シングルサインオンの仕組みを提供する

シングルサインオンとは、ユーザーが1回サインインを行うだけで、複数のアプリケーションやサービスに対して、アクセスが可能になる仕組み

# aws directory service
クラウド上で、microsoft active directoryを提供するフルマネージドサービス

# ディレクトリサーバー
アカウント管理や、ネット上に配置されているサーバーやプリンターなどのリソース情報を管理するためのサーバー

# aws system managerのパラメータストア
認証情報を必要なユーザーやアプリケーションだけが参照できるようにする仕組み①
key-valueがたのデータを保存

# aws secrets manager
認証情報を必要なユーザーやアプリケーションだけが参照できるようにする仕組み②
db認証情報やapiキーなどの秘密情報を補完し、許可されたユーザーのみがアクセスできるようにしたサービス

# マルチアカウント
個人や企業が複数のawsアカウントを利用すること
ここのアカウントの中に、それぞれ個別にawsリソースを作成して管理する

3つの利点
リソース境界の分離　開発環境へのみアクセスが許されているアカウントでは、本番環境に危害を加えられない
アクセス権限の分離　チームごとのセキュリティやコンプライアンスが保持しやすくなる
請求の分離　awsの請求は原則的にアカウント別に行われる　アカウントを分離すればどこに費用がかかっているのかがわかる

問題点
組織全体としてのコンプライアンスやガバナンスが難しくなる
請求処理が煩雑化
共通リソースの管理が複雑化

# aws organizations
複数のawsアカウントを統合的に管理する仕組み
作成済みのアカウントをOU organizations unitというグループ単位で管理することで、それぞれのアカウントで許可する範囲を限定できる
管理しているアカウントの使用量を、一つの請求書にまとめられる
新しくアカウントを作成する際、請求方法を入力しなくてよくなる
サービスコントロールポリシーscpで、管理しているアカウントに対して必ず拒否したいポリシーを設定できる。これにより、最大権限の範囲を設定できる。

# aws control tower
他サービスと連携し、ランディングゾーンが構築できる

# 仮想ファイアウォール
awsにはネットワークaclとセキュリティグループという2種類の仮想ファイアウォールがある
セキュリティグループとは、awsリソースをグループ化し、属するリソースへのインバウンド/アウトバウンド通信をフィルタリングするファイアウォール
ステートフルファイアウォールとして機能する
ステートフルとは、アウトバウンド通信に対する応答には、インバウンドルールが適用されず、暗黙的に許可されることを意味する
ネットワークaclとは、仮想プライベートネットワークのサブネットごとに設定するファイアウォール
そのサブネットに配置されているすべてのリソースあての通信をルールに従ってフィルタリングする
ステートレスファイアウォールとして機能する
つまり、アウトバウンドに対する応答にも、インバウンドのルールが適用される

インバウンド通信とは、ファイアウォールの外側から内側にはいってくる通信のこと
アウトバウンド通信とは、ファイアウォールの外側へ出ていく通信のこと

セキュリティグループはステートフル、ネットワークaclはステートレス

# 攻撃
ブルートフォースアタック　何回もログインを試してパスワードを特定する
sqlインジェクション　アプリへのリクエストにsqlを紛れ込ませてデータの削除や改ざんを目論む
osインジェクション　アプリへのリクエストにosのコマンドを紛れ込ませてosを不正に操作する攻撃
クロスサイトスクリプティング　htmlにユーザーからの入力をそのまま出力してしまうアプリの脆弱性を利用し、jsなどのスクリプトによってフィッシングサイトへ誘導したり、機密情報を入力させたりする攻撃
ddos攻撃　大量のリクエストを送り付けてサービスの応答性を著しく低下させたり、サービス自体を停止させる攻撃のことをdosといい、不特定多数の拠点から行うことをddosという

# amazon cognito
アプリにユーザー認証機能やアクセス管理の機能を追加するサービス
アプリにユーザー認証機能を提供するユーザープールと、アプリやその利用者にawsへの一時的なアクセス権限を提供するidプールの2種類
ユーザープールの機能：id/pwを管理しユーザーを認証する、mfa認証のサポート、ユーザーの自己サインアップ、パスワードふっきゅう

# aws waf
アプリに対する攻撃を遮断するwebアプリケーションファイアウォール機能を提供するサービス

# aws shield
ddos保護サービス
standard/advancedの2種類
standardは、無料で利用可能、ネットワーク層及びトランスポート層へのddos攻撃を制御
advancedは、有料サービス。standardの機能に加えてアプリケーション層への攻撃からも防御する

# amazon guardduty
アカウント内のログを機械学習を用いて解析することで、今日の検出を行う検知サービス

# amazon detective
awsのログを分析し、検出した驚異の調査に主眼を置いたサービス

# amazon inspector
仮想マシンであるec2インスタンスなどの脆弱性診断を自動で行うサービス

# aws trusted advisor
セキュリティ/コストの5つのカテゴリからawsの利用状況をモニタリングして推奨事項を教えてくれる
コスト最適化/パフォーマンス/セキュリティ/耐障害性/サービスの制限

# aws security hub
awsアカウント内のセキュリティチェックの自動化とセキュリティリスクへの警告を一元管理できるサービス

b, a, a, d, b, a/d, c, a